<html>

<head><link rel="stylesheet" href="styles.css"></head>

<body>

  <div id="modal">
    <div id="modalText">
    Iro • 色
    </br>
      <div id="modalTextSmall">
      Click to begin
      </div>
    </div>
  </div>

  <center>
  <div id="iroTitle">
  Iro • 色
  </div>
  Fixed length?
  <input type="checkbox" id="scrollToggle">
  
  Select film:
  <select id="filmSelector">
    <option value="Film1">Test</option>
    <option value="Film2">Test 1</option>
  </select>

  <button onclick="reloadData()">Click to reload</button>
  </br>
  </br>
  <div id="scrollableWindow">
    <svg></svg>
  </div>
  </br>
  </br>
  <div id ="source">
  </div>
  </center>

<script src="https://d3js.org/d3.v6.min.js"></script>

<script>

const filmMap = {
  "Film1": "json/test.json",
  "Film2": "json/test1.json"
}

async function reloadData(){
  var bins = await  d3.json(filmMap[document.getElementById("filmSelector").value])
  loadGraph(bins)
  document.getElementById("source").innerHTML = ""
}

function updateSource(sourceObj){
  source = document.getElementById("source")
  source.innerHTML = "<div><img src=\"" + sourceObj.file_name + "\" height=\"" + window.innerHeight * .25 + "\"></br></br>"+sourceObj.color +"</div>"
}

const barWidth = 10;
const height = window.innerHeight * .25;

function loadGraph(bins){
  if (document.getElementById("scrollToggle").checked){
      const width = barWidth * bins.length;
      const svg = d3.select("svg");
      svg
        .attr("width", width)
        .attr("height", height)
        .selectAll("rect")
        .data(bins)
        .join("rect")
        .attr("x", (d,i) => i*barWidth)
        .attr("width", d => barWidth)
        .attr("y", d => 0)
        .attr("fill", d => d.color)
        .on('mouseover', function(d,i){updateSource(d.toElement.__data__) })
        .attr("height", d => height);
  }
  else {
    const width = window.innerWidth * .75
    const svg = d3.select("svg")
    svg
      .attr("width", width)
      .attr("height", height)
      .selectAll("rect")
      .data(bins)
      .join("rect")
      .attr("x", (d,i) => i*(width/bins.length))
      .attr("width", d => (width/bins.length))
      .attr("y", d => 0)
      .attr("fill", d => d.color)
      .on('mouseover', function(d,i){updateSource(d.toElement.__data__) })
      .attr("height", d => height);
  }
}

var modal = document.getElementById('modal');
modal.onclick = function() {
    modal.classList.add("fade-out")
    setTimeout(function(){modal.style.display = "none"}, 990);
};
reloadData()
      
</script>

</body>

</html>
